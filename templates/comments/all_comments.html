{% extends "base.html" %}

{% load humanize %}

{% block css %}
  {{block.super}}
  <style media="screen">
    .container .title small {
      color: grey;
    }

    #comment-list {
      overflow-y: auto;
      height: calc(100vh - 150px);
    }

    #comment-list .secondary {
      margin: 10px 0 15px 0;
      color:grey;
    }
    #comment-list .card-action button {
      color: #3f51b5;
    }
    #comment-list .card-title {
      font-weight: bold;
    }
    .select-wrapper .dropdown-content {
      width: inherit !important;
    }
  </style>
{% endblock css %}

{% block content %}
  <br>
  <br>
  <div class="container">
    <div class="row">
      <div class="col s12 l3">
        <h3 class="title">
          {{candidate.name}} <br>
          <small>#{{candidate.cid}}</small>
        </h3>
        <h5 class="designation">
          Designation: {{candidate.designation}}
        </h5>
      </div>
      <div class="col s12 l9" id="comment-list">
        <ul class="collection" data-url="{% url 'candidate_comments' candidate.cid %}">
          {% include "comments/includes/comment_list.html" %}
        </ul>
      </div>
    </div>

    <div class="fixed-action-btn js-comment-create-btn" data-url="{% url 'create_comment' candidate.cid %}" data-form-target="#form-modal">
      <a class="btn-floating btn-large red" href="#form-modal">
        <i class="large material-icons">add</i>
      </a>
    </div>
  </div>
{% endblock content %}

{% block javascript %}
  {{block.super}}
  <script type="text/javascript">
  $(function () {
    $(".js-comment-create-btn").click(loadForm);
    $("#form-modal").on('submit', ".js-comment-create-form", function(event) {
      event.preventDefault();
      var form =  $(this)
      $.ajax({
        url: form.attr('action'),
        method: form.attr('method'),
        datatype: 'json',
        data: form.serialize(),
        success: function(data) {
          console.log(data)
          if(data.is_valid) {
            $("#comment-list ul").html(data.html_comment_list)
            modal_instance.close()
          }
          else {
            $("#form-modal").html(data.html_form)
            M.updateTextFields()
          }
        }
      }); //End Ajax call
    });
  });
  </script>
{% endblock javascript%}
