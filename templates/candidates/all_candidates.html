{% extends "base.html" %}

{% block css %}
{{ block.super }}
<style media="screen">
  .collection-item.empty {
    text-align: center;
  }
  .modal-footer a:hover {
    color: #3f51b5;
  }
  #form-modal .form_input {
    padding-left: 10px;
  }
</style>
{% endblock css %}

{% block content %}
  <div id="form-modal" class="modal">

  </div>
  <div class="container row">
    <ul class="collection col s12" id="candidate-list">
      {% for candidate in candidates %}
        <li class="collection-item">
          <span class="title">{{candidate.name}}</span>
          <p>{{candidate.cid}}</p>
        </li>
      {% empty %}
        <li class="collection-item empty">
          <p>Looks like you have no candidates! Create a new candidate to begin.</p>
        </li>
      {% endfor %}
    </ul>
    <div class="fixed-action-btn" id="btn-create-form">
      <a class="btn-floating btn-large red" href="#form-modal">
        <i class="large material-icons">add</i>
      </a>
    </div>
  </div>
{% endblock content %}

{% block javascript %}
  {{ block.super }}
  <script type="text/javascript">
    $(function () {
      var modal_elem= document.querySelector('.modal');
      var modal_instance = M.Modal.init(modal_elem);
      $("#btn-create-form").click(function() {
        $.ajax({
          url: '/candidates/create',
          method: 'get',
          datatype: 'json',
          success: function(data) {
            $("#form-modal").html(data.html_form)
            M.updateTextFields()
            modal_instance.open()
          }
        });
      });
      $("#form-modal").on('submit', "#create-candidate-form", function(event) {
        var form =  $(this)
        $.ajax({
          url: form.attr('action'),
          method: form.attr('method'),
          datatype: 'json',
          data: form.serialize(),
          success: function(data) {
            console.log("Form received")  
          }
        })
        event.preventDefault()
      });
    });
  </script>
{% endblock javascript %}
